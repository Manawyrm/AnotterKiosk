#!/bin/sh

# kiosk-init replaces the regular /sbin/init process temporarily.
# It mounts the config partition, looks for the splash.png logo,
# loads the graphics drivers (DRM/VC4) on Pi's, displays the logo
# and then just resumes the boot process using systemd as usual.

mount -t sysfs none /sys
mount -t proc proc /proc
mount -t devtmpfs /dev /dev
mkdir -p /dev/shm
mkdir -p /dev/pts
mount /dev/shm
mount devpts /dev/pts -t devpts
mount -o ro /boot/firmware
mount -a

if [ ! -f /boot/firmware/splash.png ]; then
    exec /sbin/init
fi

/usr/bin/kiosk-splash &

# Continue regular boot (aka systemd init)
exec /sbin/init